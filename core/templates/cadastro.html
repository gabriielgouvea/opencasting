{% extends 'base.html' %}

{% block content %}

<style>
    /* Transi√ß√µes */
    .step-container { display: none; animation: fadeIn 0.5s; }
    .step-container.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Barra de Progresso */
    .progress-wrapper { margin-bottom: 30px; position: relative; padding: 0 10px; }
    .progress-track { background-color: #e0e0e0; height: 4px; width: 100%; border-radius: 2px; }
    .progress-fill { background-color: #009688; height: 100%; width: 0%; border-radius: 2px; transition: width 0.4s ease; }
    .step-dots { display: flex; justify-content: space-between; position: absolute; top: -6px; width: 100%; left: 0; }
    .dot { width: 16px; height: 16px; background: #e0e0e0; border-radius: 50%; border: 2px solid white; transition: 0.4s; }
    .dot.active { background: #009688; transform: scale(1.2); }

    /* Inputs e Bot√µes */
    .form-group { margin-bottom: 20px; text-align: left; }
    .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 0.95rem; }
    .form-control { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; box-sizing: border-box; background: #fff; }
    .form-control:focus { border-color: #009688; outline: none; box-shadow: 0 0 0 3px rgba(0,150,136,0.1); }
    
    .btn { display: block; width: 100%; padding: 14px; background: var(--primary); color: white; border-radius: 25px; border: none; cursor: pointer; font-size: 1rem; font-weight: bold; }
    .btn-outline { background: transparent; border: 2px solid #ddd; color: #777; }

    /* Estilo "Clean" para Perguntas Extras (Igual ao resto) */
    .radio-group { display: flex; gap: 10px; margin-top: 5px; }
    .radio-option { border: 1px solid #ddd; padding: 10px; border-radius: 8px; cursor: pointer; flex: 1; text-align: center; color: #555; background: #fff; transition: 0.2s; font-size: 0.9rem; }
    input[type="radio"]:checked + label { background-color: #009688; color: white; border-color: #009688; font-weight: bold; }
    input[type="radio"] { display: none; } 
    
    /* Box de Foto */
    .photo-tips { background: #fff3e0; padding: 15px; border-radius: 8px; font-size: 0.85rem; color: #e65100; margin-bottom: 20px; border-left: 4px solid #ff9800; }
    .photo-box { border: 2px dashed #ccc; padding: 30px; text-align: center; border-radius: 12px; background: #fafafa; color: #aaa; }
</style>

<h2 style="text-align: center; color: #009688; margin-bottom: 5px;">Ficha de Cadastro</h2>
<p style="text-align: center; color: #999; font-size: 0.9rem; margin-top: 0;">Junte-se ao time em 5 passos.</p>

<div class="progress-wrapper">
    <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
    <div class="step-dots">
        <div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>
</div>

<form method="POST" enctype="multipart/form-data" id="wizardForm">
    {% csrf_token %}

    <div class="step-container active" id="step1">
        <h3 style="color: #009688;">1. Acesso</h3>
        <div class="form-group"><label class="form-label">Nome Completo</label>{{ form.nome_completo }}</div>
        <div class="form-group"><label class="form-label">E-mail</label>{{ form.email }}</div>
        <div class="form-group"><label class="form-label">Senha</label>{{ form.password }}</div>
        <div class="form-group"><label class="form-label">Confirmar Senha</label>{{ form.confirm_password }}</div>
        <button type="button" class="btn" onclick="nextStep(2)">Pr√≥ximo Passo</button>
    </div>

    <div class="step-container" id="step2">
        <h3 style="color: #009688;">2. Pessoal</h3>
        <div class="form-group"><label class="form-label">WhatsApp</label>{{ form.whatsapp }}</div>
        <div class="form-group">
            <label class="form-label">Data de Nascimento</label>
            {{ form.data_nascimento }}
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button type="button" class="btn btn-outline" onclick="prevStep(1)">Voltar</button>
            <button type="button" class="btn" onclick="nextStep(3)">Pr√≥ximo Passo</button>
        </div>
    </div>

    <div class="step-container" id="step3">
        <h3 style="color: #009688;">3. Endere√ßo</h3>
        <div class="form-group">
            <label class="form-label">CEP (Busca Autom√°tica)</label>
            {{ form.cep }}
            <small style="color: #009688; display: none;" id="cep-loading">Buscando endere√ßo...</small>
        </div>
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px;">
            <div class="form-group"><label class="form-label">Endere√ßo</label>{{ form.endereco }}</div>
            <div class="form-group"><label class="form-label">N√∫mero</label>{{ form.numero }}</div>
        </div>
        <div class="form-group"><label class="form-label">Bairro</label>{{ form.bairro }}</div>
        <div style="display: grid; grid-template-columns: 3fr 1fr; gap: 10px;">
            <div class="form-group"><label class="form-label">Cidade</label>{{ form.cidade }}</div>
            <div class="form-group"><label class="form-label">UF</label>{{ form.estado }}</div>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button type="button" class="btn btn-outline" onclick="prevStep(2)">Voltar</button>
            <button type="button" class="btn" onclick="nextStep(4)">Pr√≥ximo Passo</button>
        </div>
    </div>

    <div class="step-container" id="step4">
        <h3 style="color: #009688;">4. Perfil</h3>
        
        <div class="form-group"><label class="form-label">Altura</label>{{ form.altura }}</div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group"><label class="form-label">Manequim</label>{{ form.manequim }}</div>
            <div class="form-group"><label class="form-label">Cal√ßado</label>{{ form.calcado }}</div>
        </div>

        {% if perguntas_extras %}
            {% for pergunta in perguntas_extras %}
                <div class="form-group" style="margin-top: 25px;">
                    <label class="form-label">{{ pergunta.texto }}</label>
                    
                    {% if pergunta.tipo == 'sim_nao' %}
                        <div class="radio-group">
                            <input type="radio" id="p{{pergunta.id}}_sim" name="pergunta_{{pergunta.id}}" value="Sim">
                            <label class="radio-option" for="p{{pergunta.id}}_sim">Sim</label>
                            
                            <input type="radio" id="p{{pergunta.id}}_nao" name="pergunta_{{pergunta.id}}" value="N√£o">
                            <label class="radio-option" for="p{{pergunta.id}}_nao">N√£o</label>
                        </div>
                    {% else %}
                        <input type="text" name="pergunta_{{pergunta.id}}" class="form-control" placeholder="Responda aqui...">
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}

        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button type="button" class="btn btn-outline" onclick="prevStep(3)">Voltar</button>
            <button type="button" class="btn" onclick="nextStep(5)">Pr√≥ximo Passo</button>
        </div>
    </div>

    <div class="step-container" id="step5">
        <h3 style="color: #009688;">5. Fotos</h3>
        
        <div class="photo-tips">
            <strong>üì∏ Instru√ß√µes:</strong>
            <ul style="margin: 5px 0 0 20px; padding: 0;">
                <li><strong>Aceito:</strong> Fotos de book, sorrindo, corpo inteiro.</li>
                <li><strong>Proibido:</strong> Espelho, √≥culos escuros, filtros.</li>
            </ul>
        </div>

        <div class="photo-box">
            <i class="material-icons" style="font-size: 48px; margin-bottom: 10px;">add_a_photo</i>
            <p style="margin: 0;"><strong>Upload de Fotos</strong><br>(Liberado ap√≥s cadastro)</p>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 30px;">
            <button type="button" class="btn btn-outline" onclick="prevStep(4)">Voltar</button>
            <button type="submit" class="btn" style="background-color: #4CAF50;">FINALIZAR ‚ú®</button>
        </div>
    </div>

</form>

<script>
    // API ViaCEP
    function buscarCep(cep) {
        cep = cep.replace(/\D/g, '');
        if (cep.length === 8) {
            document.getElementById('cep-loading').style.display = 'block';
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (!data.erro) {
                        document.getElementById('rua').value = data.logradouro;
                        document.getElementById('bairro').value = data.bairro;
                        document.getElementById('cidade').value = data.localidade;
                        document.getElementById('uf').value = data.uf;
                    }
                    document.getElementById('cep-loading').style.display = 'none';
                })
                .catch(() => document.getElementById('cep-loading').style.display = 'none');
        }
    }

    // M√°scaras
    const cepInput = document.querySelector('.cep-mask');
    if(cepInput) cepInput.addEventListener('input', e => {
        let v = e.target.value.replace(/\D/g, '');
        if (v.length > 5) v = v.substring(0, 5) + '-' + v.substring(5, 8);
        e.target.value = v;
    });

    const dateInput = document.querySelector('.date-mask');
    if(dateInput) dateInput.addEventListener('input', e => {
        let v = e.target.value.replace(/\D/g, '');
        if (v.length > 2) v = v.substring(0, 2) + '/' + v.substring(2);
        if (v.length > 5) v = v.substring(0, 5) + '/' + v.substring(5, 9);
        e.target.value = v;
    });

    const heightInput = document.querySelector('.height-mask');
    if(heightInput) heightInput.addEventListener('input', e => {
        let v = e.target.value.replace(/\D/g, '');
        if (v.length > 2) v = v.substring(0, 1) + '.' + v.substring(1, 3);
        e.target.value = v;
    });

    // Wizard
    let currentStep = 1;
    const totalSteps = 5;

    function updateProgress() {
        const percent = ((currentStep - 1) / (totalSteps - 1)) * 100;
        document.getElementById('progressFill').style.width = percent + '%';
        document.querySelectorAll('.dot').forEach((dot, index) => {
            if (index < currentStep) dot.classList.add('active');
            else dot.classList.remove('active');
        });
    }

    function nextStep(step) {
        document.getElementById('step' + currentStep).classList.remove('active');
        currentStep = step;
        document.getElementById('step' + currentStep).classList.add('active');
        updateProgress();
        window.scrollTo(0, 0);
    }

    function prevStep(step) {
        document.getElementById('step' + currentStep).classList.remove('active');
        currentStep = step;
        document.getElementById('step' + currentStep).classList.add('active');
        updateProgress();
    }
</script>

{% endblock %}