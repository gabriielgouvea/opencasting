{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Link de apresentação de promotores</title>
  <style>
    :root {
      --primary: #009688;
      --dark: #2c3e50;
      --muted: #6c757d;
      --bg: #f4f6f9;
      --card: #ffffff;
      --border: rgba(0,0,0,0.06);
    }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--dark); }
    .ap-top { background: var(--card); border-bottom: 1px solid var(--border); }
    .ap-top-inner { max-width: 1200px; margin: 0 auto; padding: 18px 16px; }
    .ap-title { font-size: 1.4rem; font-weight: 900; margin: 0; letter-spacing: -0.2px; }
    .ap-sub { margin: 6px 0 0; color: var(--muted); font-size: 0.92rem; }

    .ap-wrap { max-width: 1200px; margin: 0 auto; padding: 18px 16px 26px; }

    .ap-grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 16px; }
    @media (max-width: 980px) { .ap-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (max-width: 640px) { .ap-grid { grid-template-columns: 1fr; } }

    .ap-card { background: var(--card); border-radius: 14px; overflow: hidden; box-shadow: 0 2px 14px rgba(0,0,0,0.06); border: 1px solid var(--border); }
    .ap-photos { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }
    @media (max-width: 640px) { .ap-photos { grid-template-columns: 1fr; } }

    .ap-photo { width: 100%; aspect-ratio: 3/4; background: #f1f3f5; border-radius: 12px; overflow: hidden; }
    .ap-photo img { width: 100%; height: 100%; object-fit: cover; display: block; }

    .ap-card-body { padding: 10px 12px 14px; display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .ap-name { font-weight: 800; color: var(--dark); font-size: 0.98rem; margin: 0; }
    .ap-btn { border: 0; border-radius: 10px; background: var(--primary); color: white; padding: 10px 12px; font-weight: 800; cursor: pointer; }
    .ap-btn:active { transform: translateY(1px); }

    .ap-modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.55); display: none; align-items: center; justify-content: center; padding: 18px; z-index: 2000; }
    .ap-modal { width: min(560px, 100%); background: var(--card); border-radius: 14px; overflow: hidden; box-shadow: 0 16px 40px rgba(0,0,0,0.22); }
    .ap-modal-header { padding: 14px 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
    .ap-modal-title { margin: 0; font-weight: 900; color: var(--dark); }
    .ap-close { border: 0; background: transparent; font-size: 20px; cursor: pointer; padding: 6px 10px; }
    .ap-modal-body { padding: 14px 16px 18px; }
    .ap-info { display: grid; grid-template-columns: 1fr 1fr; gap: 10px 14px; }
    @media (max-width: 520px) { .ap-info { grid-template-columns: 1fr; } }
    .ap-field { background: #f8f9fa; border: 1px solid var(--border); border-radius: 12px; padding: 10px 12px; }
    .ap-k { font-size: 0.78rem; color: var(--muted); margin: 0 0 4px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.3px; }
    .ap-v { font-weight: 800; color: var(--dark); margin: 0; word-break: break-word; }
    .ap-link { color: #00796b; text-decoration: none; font-weight: 900; }
  </style>
</head>
<body>

<header class="ap-top">
  <div class="ap-top-inner">
    <h1 class="ap-title">Link de apresentação de promotores</h1>
    <p class="ap-sub">Este link expira em 7 dias.{% if apresentacao.expira_em %} Válido até {{ apresentacao.expira_em|date:"d/m/Y" }}.{% endif %}</p>
  </div>
</header>

<main class="ap-wrap">
  <div class="ap-grid">
    {% for item in itens %}
      <div class="ap-card">
        <div class="ap-photos">
          <div class="ap-photo">
            {% if item.foto_rosto_url %}
              <img src="{{ item.foto_rosto_url }}" alt="Foto de rosto" loading="lazy">
            {% else %}
              <img src="{% static 'images/placeholder.png' %}" alt="Sem foto" loading="lazy" onerror="this.style.display='none'">
            {% endif %}
          </div>
          <div class="ap-photo">
            {% if item.foto_corpo_url %}
              <img src="{{ item.foto_corpo_url }}" alt="Foto de corpo" loading="lazy">
            {% else %}
              <img src="{% static 'images/placeholder.png' %}" alt="Sem foto" loading="lazy" onerror="this.style.display='none'">
            {% endif %}
          </div>
        </div>

        <div class="ap-card-body">
          <p class="ap-name">{{ item.nome }}</p>
          <button
            type="button"
            class="ap-btn"
            data-ap-item="1"
            data-nome="{{ item.nome|escape }}"
            data-idade="{{ item.idade|default_if_none:'' }}"
            data-altura="{{ item.altura|default_if_none:'' }}"
            data-manequim="{{ item.manequim|default_if_none:'' }}"
            data-calcado="{{ item.calcado|default_if_none:'' }}"
            data-cidade="{{ item.cidade|default_if_none:'' }}"
            data-uf="{{ item.uf|default_if_none:'' }}"
            data-instagram="{{ item.instagram|default_if_none:'' }}"
            data-instagram-url="{{ item.instagram_url|default_if_none:'' }}"
          >Ver informações</button>
        </div>
      </div>
    {% empty %}
      <div style="grid-column: 1 / -1; background: white; border-radius: 14px; padding: 16px; border: 1px solid rgba(0,0,0,0.05);">
        Nenhum promotor nessa apresentação.
      </div>
    {% endfor %}
  </div>
</main>

<div class="ap-modal-backdrop" id="apModal">
  <div class="ap-modal" role="dialog" aria-modal="true" aria-labelledby="apModalTitle">
    <div class="ap-modal-header">
      <h3 class="ap-modal-title" id="apModalTitle">Informações</h3>
      <button type="button" class="ap-close" id="apModalClose">×</button>
    </div>
    <div class="ap-modal-body">
      <div class="ap-info" id="apModalInfo"></div>
    </div>
  </div>
</div>

<script>
  (function () {
    const modal = document.getElementById('apModal');
    const closeBtn = document.getElementById('apModalClose');
    const info = document.getElementById('apModalInfo');

    function openModal(data) {
      const fields = [
        ['Nome completo', data.nome],
        ['Idade', data.idade ? (data.idade + ' anos') : '—'],
        ['Altura', data.altura ? (data.altura + ' m') : '—'],
        ['Manequim', data.manequim || '—'],
        ['Calçado', data.calcado || '—'],
        ['Cidade', data.cidade || '—'],
        ['UF', data.uf || '—'],
      ];

      info.innerHTML = fields.map(([k,v]) => (
        `<div class="ap-field"><p class="ap-k">${k}</p><p class="ap-v">${String(v)}</p></div>`
      )).join('');

      const igText = data.instagram || '—';
      const igUrl = data.instagramUrl || '';
      const igHtml = igUrl
        ? `<a class="ap-link" href="${igUrl}" target="_blank" rel="noopener noreferrer">${igText}</a>`
        : `${igText}`;

      info.insertAdjacentHTML('beforeend', `
        <div class="ap-field" style="grid-column: 1 / -1;">
          <p class="ap-k">Instagram</p>
          <p class="ap-v">${igHtml}</p>
        </div>
      `);

      modal.style.display = 'flex';
    }

    function closeModal() {
      modal.style.display = 'none';
    }

    document.addEventListener('click', function (e) {
      const btn = e.target.closest && e.target.closest('[data-ap-item]');
      if (btn) {
        openModal({
          nome: btn.getAttribute('data-nome') || '',
          idade: btn.getAttribute('data-idade') || '',
          altura: btn.getAttribute('data-altura') || '',
          manequim: btn.getAttribute('data-manequim') || '',
          calcado: btn.getAttribute('data-calcado') || '',
          cidade: btn.getAttribute('data-cidade') || '',
          uf: btn.getAttribute('data-uf') || '',
          instagram: btn.getAttribute('data-instagram') || '',
          instagramUrl: btn.getAttribute('data-instagram-url') || '',
        });
      }

      if (e.target === modal) {
        closeModal();
      }
    });

    closeBtn.addEventListener('click', closeModal);
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') closeModal();
    });
  })();
</script>

</body>
</html>
