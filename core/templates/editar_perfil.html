{% extends 'base.html' %}

{% block content %}

<style>
    /* --- ESTILOS DA P√ÅGINA DE EDI√á√ÉO --- */
    .edit-container { 
        display: grid; 
        grid-template-columns: 350px 1fr; 
        gap: 30px; 
        align-items: start; 
        margin-top: 20px;
    }

    /* Coluna Esquerda (FOTOS) */
    .photos-card {
        background: white; border-radius: 12px; padding: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center;
        position: sticky; top: 100px;
    }
    
    .current-avatar {
        width: 150px; height: 150px; border-radius: 50%; 
        object-fit: cover; border: 5px solid #f0f0f0; margin-bottom: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    /* Bot√µes de Upload */
    .upload-btn-wrapper {
        position: relative; overflow: hidden; display: inline-block; width: 100%; margin-bottom: 15px;
    }
    
    .btn-upload {
        border: 2px dashed #ddd; color: #666; background-color: white;
        padding: 12px 20px; border-radius: 8px; font-size: 0.9rem; font-weight: 600;
        width: 100%; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    
    .btn-upload:hover { border-color: #009688; color: #009688; background: #e0f2f1; }
    .btn-upload.file-selected { border-color: #2e7d32; background: #e8f5e9; color: #2e7d32; border-style: solid; }

    /* Coluna Direita (DADOS) */
    .form-card {
        background: white; border-radius: 12px; padding: 40px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    h2.form-title { margin-top: 0; color: #333; font-weight: 800; border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 30px; }

    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .full-width { grid-column: 1 / -1; }

    label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; font-size: 0.9rem; }
    
    .form-control { 
        width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
        font-size: 1rem; box-sizing: border-box; transition: 0.3s;
    }
    .form-control:focus { border-color: #009688; outline: none; box-shadow: 0 0 0 3px rgba(0,150,136,0.1); }

    .btn-save {
        background: #009688; color: white; padding: 15px 30px; border: none; 
        border-radius: 30px; font-weight: bold; font-size: 1.1rem; cursor: pointer; 
        width: 100%; margin-top: 30px; transition: 0.3s;
    }
    .btn-save:hover { background: #00796b; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,150,136,0.3); }

    .alert-error { background: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffcdd2; }

    @media (max-width: 900px) {
        .edit-container { grid-template-columns: 1fr; }
        .form-grid { grid-template-columns: 1fr; }
        .photos-card { position: static; margin-bottom: 20px; }
    }
</style>

<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="edit-container">
        
        <div class="photos-card">
            <h3 style="margin-top:0; color:#009688;">Suas Fotos</h3>
            
            {% if form.instance.foto_rosto %}
                <img src="{{ form.instance.foto_rosto.url }}" class="current-avatar" id="preview-rosto">
            {% else %}
                <div class="current-avatar" style="display:flex; align-items:center; justify-content:center; background:#eee; font-size:3rem; margin: 0 auto 20px; color:#aaa;">üë§</div>
            {% endif %}

            <p style="font-size:0.85rem; color:#888; margin-bottom: 20px;">Toque abaixo para alterar:</p>

            <div class="upload-btn-wrapper">
                <div class="btn-upload" id="btn-rosto" onclick="document.getElementById('input_foto_rosto').click()">
                    <i class="material-icons">face</i> Foto de Perfil/Rosto
                </div>
                <input type="file" name="foto_rosto" id="input_foto_rosto" style="display:none;" accept="image/*">
            </div>

            <div class="upload-btn-wrapper">
                <div class="btn-upload" id="btn-corpo" onclick="document.getElementById('input_foto_corpo').click()">
                    <i class="material-icons">accessibility_new</i> Foto de Corpo Inteiro
                </div>
                <input type="file" name="foto_corpo" id="input_foto_corpo" style="display:none;" accept="image/*">
            </div>
        </div>

        <div class="form-card">
            <h2 class="form-title">Editar Dados Pessoais</h2>

            {% if perfil and perfil.status == 'correcao' %}
                <div class="alert-error" style="border-color:#b2dfdb; background:#e0f2f1; color:#00695c;">
                    <strong>Ajustes necess√°rios:</strong>
                    <div style="margin-top:8px;">
                        <div><strong>Motivo:</strong> {{ perfil.get_motivo_reprovacao_display }}</div>
                        {% if perfil.observacao_admin %}
                            <div style="margin-top:6px;"><strong>Mensagem da ag√™ncia:</strong> {{ perfil.observacao_admin }}</div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}

            {% if form.errors %}
                <div class="alert-error">
                    <strong>Ops! Verifique os campos:</strong>
                    {{ form.errors }}
                </div>
            {% endif %}

            <div class="form-grid">
                <div class="full-width">
                    <label>Nome Completo</label>
                    {{ form.nome_completo }}
                </div>

                <div>
                    <label>WhatsApp</label>
                    {{ form.whatsapp }}
                </div>

                <div>
                    <label>Data de Nascimento</label>
                    <input type="text" name="data_nascimento" 
                           value="{{ form.instance.data_nascimento|date:'d/m/Y'|default:'' }}" 
                           class="form-control date-mask" 
                           placeholder="DD/MM/AAAA">
                </div>

                <div class="full-width" style="margin-top:15px; border-top:1px solid #eee; padding-top:15px; color:#009688; font-weight:bold;">üìç Endere√ßo</div>

                <div><label>CEP</label>{{ form.cep }}</div>
                <div class="full-width"><label>Endere√ßo</label>{{ form.endereco }}</div>
                <div><label>N√∫mero</label>{{ form.numero }}</div>
                <div><label>Bairro</label>{{ form.bairro }}</div>
                <div><label>Cidade</label>{{ form.cidade }}</div>
                <div><label>Estado</label>{{ form.estado }}</div>

                <div class="full-width" style="margin-top:15px; border-top:1px solid #eee; padding-top:15px; color:#009688; font-weight:bold;">üìè Medidas</div>

                <div><label>Altura (ex: 1.70)</label>{{ form.altura }}</div>
                <div><label>Manequim</label>{{ form.manequim }}</div>
                <div><label>Cal√ßado</label>{{ form.calcado }}</div>

                <div class="full-width" style="margin-top:15px; border-top:1px solid #eee; padding-top:15px; color:#009688; font-weight:bold;">üè¶ Dados Banc√°rios</div>

                <div class="full-width"><label>CPF</label>{{ form.cpf }}</div>
                
                <div><label>Tipo Chave PIX</label>{{ form.tipo_chave_pix }}</div>
                <div><label>Chave PIX</label>{{ form.chave_pix }}</div>
                
                <div><label>Banco</label>{{ form.banco }}</div>
                <div><label>Tipo de Conta</label>{{ form.tipo_conta }}</div>
                <div><label>Ag√™ncia</label>{{ form.agencia }}</div>
                <div><label>Conta</label>{{ form.conta }}</div>

            </div>

            <button type="submit" class="btn-save">SALVAR ALTERA√á√ïES ‚ú®</button>
            <a href="{% url 'lista_vagas' %}" style="display:block; text-align:center; margin-top:15px; color:#666; text-decoration:none;">Cancelar e Voltar</a>
        </div>
    </div>
</form>

<script>
    // 1. Script para mudar o texto e cor do bot√£o quando seleciona foto
    function setupFileUpload(inputId, btnId) {
        const input = document.getElementById(inputId);
        const btn = document.getElementById(btnId);
        
        if(input && btn) {
            input.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    btn.innerHTML = `<i class="material-icons">check_circle</i> Arquivo Selecionado`;
                    btn.classList.add('file-selected');
                }
            });
        }
    }
    setupFileUpload('input_foto_rosto', 'btn-rosto');
    setupFileUpload('input_foto_corpo', 'btn-corpo');

    // 2. M√°scaras de Input (Reaproveitadas do cadastro)
    const applyMask = (selector, formatFunc) => {
        const els = document.querySelectorAll(selector);
        els.forEach(el => {
            el.addEventListener('input', e => { 
                e.target.value = formatFunc(e.target.value.replace(/\D/g, '')); 
            });
        });
    };

    // Data DD/MM/AAAA
    applyMask('.date-mask', v => {
        if (v.length > 2) v = v.substring(0, 2) + '/' + v.substring(2);
        if (v.length > 5) v = v.substring(0, 5) + '/' + v.substring(5, 9);
        return v;
    });

    // Altura 1.70
    applyMask('.height-mask', v => {
        if (v.length > 2) v = v.substring(0, 1) + '.' + v.substring(1, 3);
        return v;
    });

    // CPF
    applyMask('.cpf-mask', v => {
        if (v.length > 3) v = v.substring(0, 3) + '.' + v.substring(3);
        if (v.length > 7) v = v.substring(0, 7) + '.' + v.substring(7);
        if (v.length > 11) v = v.substring(0, 11) + '-' + v.substring(11, 13);
        return v;
    });
</script>

{% endblock %}